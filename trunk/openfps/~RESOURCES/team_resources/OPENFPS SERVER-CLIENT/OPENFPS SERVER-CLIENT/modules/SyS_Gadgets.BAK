Rem ***** Included Source File *****
//////////////////
// ************** Included Source File **************                             
// TITAN ENGINE Gadgets MODULE
// 
// Author: miso
//
//////////////////////////////////////////////////////

`----- Changelog:
`(2010/07/11) - miso     - Created
`----- To-Do:

`----- Purpose:

`----- USES: none

`----- Function List:

`=========Constants=========`
#Constant SyS_Left      = 1          :` left oriented texts used when you add mouseinfo for a gdget
#Constant SyS_Middle    = 2          :` middle oriented texts
#Constant SyS_Right     = 3          :` right oriented texts


`===========================`

`==========Globals==========`
Global MainMenuElementImage 		as Integer  :` 0, yet unused
Global SyS_GuiStatus            	as Boolean  :` SyS_True if some gui and mouse is present
Global SyS_GuiInitialized       	as Boolean  :` SyS_True if SyS_Initmainmenugrapfhics initialized
Global SyS_GadgetImageNumbers     	as Integer  :` Number of the loaded gadget images
Global SyS_GadgetNumbers     		as Integer  :` Number of the currently created gadgets.             
Global SyS_TextLines                as Integer  :` Number of the individual text gadgets (for scrolling)  
Global SyS_TextlinesXOffset         as Integer  :` For text scrolls        
Global SyS_TextlinesYOffset         as Integer  :` For text scrolls             
Global SyS_GadgetFunctionReturner 	as Integer  :` 0, yet unused
Global SyS_MouseOveredGadget$       as String   :` Value=IDname of the currently mouseovered gadget. Gets its value from (SyS_Gadgets(x).gadgetname).
Global SyS_OldMouseoveredGadget$    as String   :` IDname of the mouseovered gadget of the last loop.  
Global SyS_MouseClicked             as Boolean  :` 1 if mouse left click is pressed, otherwise 0               
Global SyS_MouseOverSND             as Integer  :` DBPro sound ID for mousover sound  
Global SyS_MouseClickSND            as Integer  :` DBPro sound ID for mouseclick sound   
Global SyS_GuiFaded                 as Boolean  :` 1 if we faded out all gui gadget, otherwise 0        
Global SyS_NonGuiMouseDisabled      as Boolean  :` true if we disabled the nongui mousemoves
`===========================`

`===========Types===========`
//--
Type MyGuiType
	ID               		as   Integer  :` ASprite image pointer. it gets value from SyS_Gadgetimages(x).GadgetImagePointer.
	MouseoverID      		as   Integer  :` Image pointer of gadget if mouseovered.
	GadgetName       		as   String   :` IDname of the gadget, Case sensitive, please use a prefix if you create a gadget
	GadgetType       		as   String   :` Remained unused, will remove later
	X                		as   Integer  :` Gadget upper left x coord in pixels              
	Y                		as   Integer  :` Gadget upper left y coord in pixels                
	Width            		as   Integer  :` Gadget width in pixels, auto counted.                         
	Height           		as   Integer  :` Gadget height in pixels, auto counted.                           
	Barwidth                as   Integer  :` Width of a single bar image. (bars and sliders)
	BarHeight               as   Integer  :` Height if a single bar.                
	TitleFontID				as   Integer  :` Font ID of the gadgets title text.    
	TitleX					as   Integer  :` Middle x coordinata of the gadgets title text
	TitleY 					as   Integer  :` Middle y coordinata of the gadgets title text
	Title            		as   String   :` Text of the gadget's title, if has one
	MouseoverTitleFontID    as   Integer  :` Font ID in case of mouseovered status
	MouseovertitleX 		as   Integer  :` mouseover titlefont x position
	MouseoverTitleY 		as   Integer  :` mouseover titlefont y position
	MOuseoverTitle          as   String   :` mouseover text              
	Selected                as   Boolean  :` radiobutton status on=1,off=0
	SelectedID              as   Integer  :` gagdget Image pointer if selected=1
	Faded                   as   Boolean  :` 1, if we faded out Gadget
	Value                   as   Integer  :` Current value of gadget, it makes sense only if the gadget is a slider ot bar
	MaxValue                as   Integer  :` value maximum
	MouseInfoExist          as   Boolean  :` 1, if mouseover info text exists                            
	MouseInfoText           as   String   :` Mouseinfo text                                        
	MouseInfoOrientation    as   Integer  :` 1=left 2=middle 3=right                            
EndType


//--Will hold the gadget image's pointers
Type MyGuiImageType
	GadgetImagePointer      as Integer    :` advanced sprite pointers to gadget images             
	GadgetImageName         as String     :` ID for the image, case sensitive, use prefix
EndType

//--
Type MytextoutputType
	ID               		as   Integer  :` Asprite pointer ID, gets value from a font image pointer
	X                		as   Integer  :` X coord in pixel
	Y                		as   Integer  :` Y coord in pixel
	Title            		as   String   :` Text
EndType
`===========================`


`=========Functions=========`

Function SyS_DisableNonguiMouse()
//***************************************************************************************
//*   Miso                                                                              *
//*     Disables all nongui mouse movements. Camera wont rotate if we set this.         *
//*                                                                                     *
//***************************************************************************************
	SyS_NonGuiMouseDisabled = SyS_True
Endfunction

Function SyS_EnableNonguiMouse()
//***************************************************************************************
//*   Miso                                                                              *
//*     Ensables all nongui mouse movements. Camera will rotate if we set this.         *
//*                                                                                     *
//***************************************************************************************
	SyS_NonGuiMouseDisabled = SyS_False
Endfunction



Function SyS_AddTextLine(FontID,Xx,Yy,stringtext$)
//***************************************************************************************
//*   Miso                                                                              *
//*     Creates a text gadget without any button or panel.                              *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
If SyS_GuiInitialized=SyS_True
	SyS_SetDebugPosition("SyS_AddTextLine()","module_ui.dba")
		SyS_CheckDxSprites()    
		SyS_TextLines = SyS_TextLines+1
		array insert at bottom SyS_TextoutputLines()
		SyS_Textoutputlines(SyS_TextLines).ID    = FontID
		SyS_Textoutputlines(SyS_TextLines).X     = Xx
		SyS_Textoutputlines(SyS_TextLines).Y     = Yy
		SyS_Textoutputlines(SyS_TextLines).Title = stringtext$
	SyS_RestoreDebugPosition()
Endif

Endfunction




Function SyS_ScrollTextLine(Xoffset,Yoffset)
//***************************************************************************************
//*   Miso                                                                              *
//*     Scrolls all the created text gadgets with the offset values                     *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
If SyS_GuiInitialized = SyS_True
	SyS_TextLinesXOffset = SyS_TextLinesXOffset+xoffset
	SyS_TextLinesYOffset = SyS_TextLinesYOffset+yoffset
Endif

Endfunction





Function SyS_ResetTextLineOffset()
//***************************************************************************************
//*   Miso                                                                              *
//*    Set text gadgets offset to 0.                                                    *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
If SyS_GuiInitialized = SyS_True
	SyS_TextLinesXOffset = 0
	SyS_TextLinesYOffset = 0
Endif

Endfunction





Function SyS_SetTextLineOffset(param_x as integer ,param_y as integer )
//***************************************************************************************
//*   Miso                                                                              *
//*      Sets the text gadgets offset.                                                  *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
If SyS_GuiInitialized = SyS_True
	SyS_TextLinesXOffset = param_x
	SyS_TextLinesYOffset = param_y
Endif

Endfunction






Function SyS_Fadeoutallguis()
//***************************************************************************************
//*   Miso                                                                              *
//*     Fades out all gadgets. Not too handy, dont know why i made this.                *
//*                                                                                     *
//***************************************************************************************
	If SyS_GuiInitialized = SyS_True and SyS_GadgetNumbers>0 and SyS_GuiFaded=SyS_False
		SyS_GuiFaded = SyS_True
		For x=1 to SyS_GadgetNumbers
			DXS SET SPRITE ALPHA SyS_Gadgets(x).ID,50
			If SyS_Gadgets(x).mouseoverid>0 then DXS SET SPRITE ALPHA SyS_Gadgets(x).mouseoverID,50
			If SyS_Gadgets(x).selectedid>0 then DXS SET SPRITE ALPHA SyS_Gadgets(x).selectedID,50
			SyS_Gadgets(x).faded = 1
		Next x
	Endif
Endfunction





Function SyS_Fadeinallguis()
//***************************************************************************************
//*   Miso                                                                              *
//*     Fades in all gadgets.                                                           *
//*                                                                                     *
//***************************************************************************************
	If SyS_GuiInitialized=SyS_True and SyS_GadgetNumbers>0 and SyS_GuiFaded=SyS_True
		SyS_GuiFaded = SyS_False
		For x = 1 to SyS_GadgetNumbers
			DXS SET SPRITE ALPHA SyS_Gadgets(x).ID,255
			If SyS_Gadgets(x).mouseoverid>0 then DXS SET SPRITE ALPHA SyS_Gadgets(x).mouseoverID,255
			If SyS_Gadgets(x).selectedid>0 then DXS SET SPRITE ALPHA SyS_Gadgets(x).selectedID,255
			SyS_Gadgets(x).faded = SyS_False
		Next x
	Endif
Endfunction





Function SyS_ClearAllGuis()
//***************************************************************************************
//*   Miso                                                                              *
//*     Deletes all gadgets, but leaves the images.                                     *
//*                                                                                     *
//***************************************************************************************
	If SyS_GuiInitialized = SyS_True
		
		//Check if Gadgets exist
		If SyS_GadgetNumbers>0
			Undim SyS_Gadgets()
			Dim SyS_Gadgets(0) as MyGuiType
			SyS_Gadgetnumbers = 0
		Endif
		
		// check if independent texts exist
		If SyS_TextLines>0
			Undim SyS_TextoutputLines()
			Dim SyS_TextoutputLines(0) as mytextoutputtype
			SyS_TextLines = 0
		Endif
		SyS_Settextlineoffset(0,0)
		
	Endif
Endfunction






Function SyS_LoadAndSetMouseOverSND(snd$)
//***************************************************************************************
//*   Miso                                                                              *
//*     Load a sound for mouseover event. Automata.                                     *
//*                                                                                     *
//***************************************************************************************
	SyS_SetDebugPosition("SyS_SetMouseOverSND()","module_ui.dba")
		SyS_WriteLog(SyS_Green,"loading mouseover sound : " + snd$ + ".")
		SyS_CheckFile(snd$)
		SyS_MouseOverSND = GrabResource(res_Sound)
		Load Sound snd$,SyS_MouseOverSND
		SyS_WriteLog(SyS_Green,"sound succesfully loaded")
	SyS_RestoreDebugPosition()
Endfunction







Function SyS_LoadAndSetMouseClickSND(snd$)
//***************************************************************************************
//*   Miso                                                                              *
//*     Loads a sound for mouseclick events. Playing that sound is not automatical.     *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
	SyS_SetDebugPosition("SyS_SetMouseClickSND()","module_ui.dba")
		SyS_WriteLog(SyS_Green,"loading mouse click sound : " + snd$ + ".")
		SyS_CheckFile(snd$)
		SyS_MouseClickSND = GrabResource(res_Sound)
		load sound snd$,SyS_MouseClickSND
		SyS_WriteLog(SyS_Green,"sound succesfully loaded.")
	SyS_RestoreDebugPosition()      :
Endfunction







Function SyS_PlayMouseClickSND()
//***************************************************************************************
//*   Miso                                                                              *
//*     Plays the mouseclick sound, if we loaded one before.                            *
//*                                                                                     *
//***************************************************************************************
	`SyS_SetDebugPosition("SyS_PlayMouseClickSND()","module_ui.dba")
	If SyS_MouseclickSND>0 and Sound exist(SyS_MouseclickSND)=1 and SyS_MouseClicked=SyS_False then play Sound SyS_MouseclickSND
	SyS_MouseClicked = SyS_True
	`SyS_RestoreDebugPosition()
Endfunction







Function SyS_InitGuiGraphics()
//***************************************************************************************
//*   Miso                                                                              *
//*     Initiate the gui graphics for gadgets, creates the necessery arrays.            *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
	SyS_SetDebugPosition("SyS_InitGuiGraphics()","module_ui.dba")
		SyS_CheckDxSprites()
		Dim SyS_Gadgets(0)          as MyGuiType
		Dim SyS_Gadgetimages(0)     as MyGuiImageType
		Dim SyS_TextOutputlines(0)  as Mytextoutputtype
		SyS_TextLines = 0
		SyS_GuiInitialized = SyS_True
	SyS_RestoreDebugPosition()
Endfunction







Function SyS_LoadGuiGraphics(ImageFile$,ImageID$)
//***************************************************************************************
//*   Miso                                                                              *
//*     This will load an image for gadgets, and sets GadgetID to it as an ID.           *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
	SyS_SetDebugPosition("SyS_LoadGuiGraphics(menugombimage$)","module_ui.dba")
		SyS_WriteLog(SyS_Green,"Loading gui image : " + imagefile$ + " with ID "+ImageID$+"."	)
		SyS_CheckDxSprites():SyS_CheckFile(ImageFile$)
		Array Insert at Bottom SyS_Gadgetimages()
		
		SyS_GadgetImageNumbers                                     = SyS_GadgetImageNumbers+1
		SyS_Gadgetimages(SyS_GadgetImageNumbers).GadgetImagePointer = DXS CREATE SPRITE(ImageFile$)
		SyS_Gadgetimages(SyS_GadgetImageNumbers).GadgetImageName    = ImageID$
		SyS_WriteLog(SyS_Green,"loaded image successfully.")
	SyS_RestoreDebugPosition()      
Endfunction



Function SyS_GetGadgetwidth(gadgetidname$)
//***************************************************************************************
//*   Miso                                                                              *
//*     Returns width of the gadget                                                     *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
local return_param as integer
local x as Integer
	If SyS_GuiInitialized = SyS_True
		If SyS_GadgetNumbers>SyS_False
			For x=1 to SyS_GadgetNumbers
				If SyS_Gadgets(x).Gadgetname = gadgetIDname$ then return_param = SyS_Gadgets(x).width
			Next x
		Endif
	Endif
Endfunction return_param


Function SyS_GetGadgetheight(gadgetidname$)
//***************************************************************************************
//*   Miso                                                                              *
//*     Returns height of the gadget.                                                   *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
local return_param as integer
local x as Integer
	If SyS_GuiInitialized = SyS_True
		If SyS_GadgetNumbers>SyS_False
			For x=1 to SyS_GadgetNumbers
				If SyS_Gadgets(x).Gadgetname = gadgetIDname$ then return_param = SyS_Gadgets(x).height
			Next x
		Endif
	Endif
Endfunction return_param




Function SyS_GadgetExist(gadgetidname$)
//***************************************************************************************
//*   Miso                                                                              *
//*     Returns 1 if gadget exists with the given name.                                 *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
local return_param as Boolean
local x as Integer
	If SyS_GuiInitialized = SyS_True
		If SyS_GadgetNumbers>SyS_False
			For x=1 to SyS_GadgetNumbers
				If SyS_Gadgets(x).Gadgetname = gadgetIDname$ then return_param = SyS_True
			Next x
		Endif
	Endif
Endfunction return_param


Function SyS_MoveGadget(gadgetidname$,param_x,param_y)
//***************************************************************************************
//*   Miso                                                                              *
//*     Offset Gadget position with param_x and param_y.                                *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************

local x as Integer
	If SyS_GuiInitialized = SyS_True
		If SyS_GadgetNumbers>SyS_False
			For x=1 to SyS_GadgetNumbers
				If SyS_Gadgets(x).Gadgetname = gadgetIDname$ 
					SyS_gadgets(x).x=SyS_gadgets(x).x+param_x
					SyS_gadgets(x).y=SyS_gadgets(x).y+param_y
					SyS_gadgets(x).titlex=SyS_gadgets(x).titlex+param_x
					SyS_gadgets(x).titley=SyS_gadgets(x).titley+param_y
					
					rem if 	SyS_gadgets(x).x>(SyS_Display.width-SyS_gadgets(x).width) then SyS_gadgets(x).x=(SyS_Display.width-SyS_gadgets(x).width)
						
					
					
				Endif
			Next x
		Endif
	Endif
Endfunction




Function SyS_GadgetImageExist(gadgetimagename$)
//***************************************************************************************
//*   Miso                                                                              *
//*     Returns 1 if the gadgetimage exists with the specified name.                    *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
local return_param as Boolean
local x as Integer
	If SyS_GuiInitialized = SyS_True
		If SyS_GadgetimageNumbers>SyS_False
			For x=1 to SyS_GadgetimageNumbers
				If SyS_Gadgetimages(x).Gadgetimagename = gadgetimagename$ then return_param = SyS_True
			Next x
		Endif
	Endif
Endfunction return_param





Function SyS_CenterPercentPositionGadget(gadgetidname$,posx,posy)
//***************************************************************************************
//*   Miso                                                                              *
//*     Brings gadgets to posx and posy, centered. Posx and posy are percentages.       *
//*     (0-100)                                                                         *
//*                                                                                     *
//***************************************************************************************

If SyS_GuiInitialized=SyS_True
local relativeX# as Float
local relativeY# as Float
local offsetX    as Integer
local offsetY    as Integer
local xdiff      as Integer
local ydiff      as Integer

relativeX# = (SyS_Display.Width/100.0)*posx
relativeY# = (SyS_Display.Height/100.0)*posy
relativeX# = Int(relativeX#)
relativeY# = Int(relativeY#)

	SyS_SetDebugPosition("SyS_AddCenterPercentPositionGadget()","module_ui.dba")
		SyS_CheckDxSprites()
		For x=1 to SyS_Gadgetnumbers
			If SyS_Gadgets(x).Gadgetname = gadgetidname$
				offsetX = 0+relativeX#-(SyS_Gadgets(x).width/2)
				OffsetY = 0+relativeY#-(SyS_Gadgets(x).height/2)
				xdiff = SyS_Gadgets(x).X-OffsetX
				ydiff = SyS_Gadgets(x).Y-OffsetY
				SyS_Gadgets(x).X               = offsetX
				SyS_Gadgets(x).Y               = offsetY
				SyS_Gadgets(x).TitleX          = SyS_Gadgets(x).TitleX-XDiff
				SyS_Gadgets(x).TitleY          = SyS_Gadgets(x).TitleY-YDiff
				SyS_Gadgets(x).MouseoverTitleX = SyS_Gadgets(x).MouseoverTitleX-XDiff
				SyS_Gadgets(x).MouseoverTitleY = SyS_Gadgets(x).MouseoverTitleY-YDiff
			Endif
		Next x
	SyS_RestoreDebugPosition()
Endif
Endfunction






Function SyS_CenterPositionGadget(gadgetidname$,posx,posy)
//***************************************************************************************
//*   Miso                                                                              *
//*     Position gadget to posx, posy, centered. posx and posy are pixels.              *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************

If SyS_GuiInitialized=SyS_True
local offsetX as Integer
local offsetY as Integer
local xdiff   as Integer
local ydiff   as Integer


	SyS_SetDebugPosition("SyS_CenterPositionGadget()","module_ui.dba")
		SyS_CheckDxSprites()
		For x=1 to SyS_Gadgetnumbers
			If SyS_Gadgets(x).Gadgetname = gadgetidname$
				offsetX                       = posx-(SyS_Gadgets(x).width/2)
				OffsetY                       = posy-(SyS_Gadgets(x).height/2)
				xdiff                         = SyS_Gadgets(x).X-OffsetX
				ydiff                         = SyS_Gadgets(x).Y-OffsetY
				SyS_Gadgets(x).X               = offsetX
				SyS_Gadgets(x).Y               = offsetY
				SyS_Gadgets(x).TitleX          = SyS_Gadgets(x).TitleX-XDiff
				SyS_Gadgets(x).TitleY          = SyS_Gadgets(x).TitleY-YDiff
				SyS_Gadgets(x).MouseoverTitleX = SyS_Gadgets(x).MouseoverTitleX-XDiff
				SyS_Gadgets(x).MouseoverTitleY = SyS_Gadgets(x).MouseoverTitleY-YDiff
			Endif
		Next x
	SyS_RestoreDebugPosition()
Endif
Endfunction






Function SyS_PositionGadget(gadgetidname$,posx,posy)
//***************************************************************************************
//*   Miso                                                                              *
//*     Positions a gadget to posx, posy. Posx and Posy will be the top left point of   *
//*     the gadget in pixels.                                                           *
//*                                                                                     *
//***************************************************************************************
local offsetX as integer
local offsetY as integer
local xdiff   as integer
local ydiff   as integer

If SyS_GuiInitialized = SyS_True
	SyS_SetDebugPosition("SyS_PositionGadget()","module_ui.dba")
		SyS_CheckDxSprites()
		For x=1 to SyS_Gadgetnumbers
			If SyS_Gadgets(x).Gadgetname = gadgetidname$
				offsetX                       = posx
				OffsetY                       = posy
				xdiff                         = SyS_Gadgets(x).X-OffsetX
				ydiff                         = SyS_Gadgets(x).Y-OffsetY
				SyS_Gadgets(x).X               = offsetX
				SyS_Gadgets(x).Y               = offsetY
				SyS_Gadgets(x).TitleX          = SyS_Gadgets(x).TitleX-XDiff
				SyS_Gadgets(x).TitleY          = SyS_Gadgets(x).TitleY-YDiff
				SyS_Gadgets(x).MouseoverTitleX = SyS_Gadgets(x).MouseoverTitleX-XDiff
				SyS_Gadgets(x).MouseoverTitleY = SyS_Gadgets(x).MouseoverTitleY-YDiff
			Endif
		Next x
	SyS_RestoreDebugPosition()
Endif
Endfunction






Function SyS_AddCenterGadgetToScreen(gadgetidname$,posx,posy,gadgetimagename$)
//***************************************************************************************
//*   Miso                                                                              *
//*     Add a new gadget to the list. Posx and posy will be the center point of the     *
//*     gadget in pixels.                                                               *
//*                                                                                     *
//***************************************************************************************
If SyS_GuiInitialized=SyS_True
	SyS_SetDebugPosition("SyS_AddCenterGadgettoscreen()","module_ui.dba")
		SyS_CheckDxSprites()
		For x=1 to SyS_GadgetImageNumbers
			If SyS_Gadgetimages(x).Gadgetimagename=gadgetimagename$
				Array Insert at Bottom SyS_Gadgets(1)
				SyS_GadgetNumbers                        = SyS_GadgetNumbers+1
				SyS_Gadgets(SyS_GadgetNumbers).ID         = SyS_Gadgetimages(x).gadgetimagepointer
				SyS_Gadgets(SyS_GadgetNumbers).Gadgetname = gadgetIDname$
				SyS_Gadgets(SyS_GadgetNumbers).Width      = DXS GET SPRITE TEXTURE WIDTH(SyS_Gadgets(SyS_GadgetNumbers).ID)
				SyS_Gadgets(SyS_GadgetNumbers).Height     = DXS GET SPRITE TEXTURE HEIGHT(SyS_Gadgets(SyS_GadgetNumbers).ID)
				SyS_Gadgets(SyS_GadgetNumbers).X          = posx-(SyS_Gadgets(SyS_GadgetNumbers).Width/2)
				SyS_Gadgets(SyS_GadgetNumbers).Y          = posy-(SyS_Gadgets(SyS_GadgetNumbers).Height/2)
			Endif
		Next x
	SyS_RestoreDebugPosition()
Endif
Endfunction






Function SyS_AddGadgetToScreen(gadgetidname$,posx,posy,gadgetimagename$)
//***************************************************************************************
//*   Miso                                                                              *
//*     Add a gadget to the list, posx and posy will be the gadgets upper left point in *
//*     pixels.                                                                         *
//*                                                                                     *
//***************************************************************************************
If SyS_GuiInitialized=SyS_True
	SyS_SetDebugPosition("SyS_AddGadgetToScreen()","module_ui.dba")
		SyS_CheckDxSprites()
		For x=1 to SyS_GadgetImageNumbers
			If SyS_Gadgetimages(x).Gadgetimagename = gadgetimagename$
				Array Insert at Bottom SyS_Gadgets(1)
				SyS_GadgetNumbers                        = SyS_GadgetNumbers+1
				SyS_Gadgets(SyS_GadgetNumbers).ID         = SyS_Gadgetimages(x).gadgetimagepointer
				SyS_Gadgets(SyS_GadgetNumbers).Gadgetname = gadgetIDname$
				SyS_Gadgets(SyS_GadgetNumbers).x          = posx
				SyS_Gadgets(SyS_GadgetNumbers).y          = posy
				SyS_Gadgets(SyS_GadgetNumbers).width      = DXS GET SPRITE TEXTURE WIDTH(SyS_Gadgets(SyS_GadgetNumbers).ID)
				SyS_Gadgets(SyS_GadgetNumbers).height     = DXS GET SPRITE TEXTURE HEIGHT(SyS_Gadgets(SyS_GadgetNumbers).ID)
			Endif
		Next x
	SyS_RestoreDebugPosition()
Endif
Endfunction






Function SyS_AddBarGadgetToScreen(gadgetidname$,posx,posy,gadgetimagename$,maxvalue)
//***************************************************************************************
//*   Miso                                                                              *
//*     Creates a barslider gadget. Posx and posy will be the upper left point of       *
//*     the gadget in pixels.                                                           *
//*                                                                                     *
//***************************************************************************************
If SyS_GuiInitialized=SyS_True
	SyS_SetDebugPosition("SyS_AddBarGadgetToScreen()","module_ui.dba") 
		SyS_CheckDxSprites()
		For x=1 to SyS_GadgetImageNumbers
			If SyS_Gadgetimages(x).Gadgetimagename=gadgetimagename$
				Array Insert at Bottom SyS_Gadgets(1)
				SyS_GadgetNumbers                          =  SyS_GadgetNumbers+1
				SyS_Gadgets(SyS_GadgetNumbers).ID           =  SyS_Gadgetimages(x).gadgetimagepointer
				SyS_Gadgets(SyS_GadgetNumbers).Gadgetname   =  gadgetIDname$
				SyS_Gadgets(SyS_GadgetNumbers).x            =  posx
				SyS_Gadgets(SyS_GadgetNumbers).y            =  posy
				SyS_Gadgets(SyS_GadgetNumbers).width        =  DXS GET SPRITE TEXTURE WIDTH(SyS_Gadgets(SyS_GadgetNumbers).ID)*maxvalue
				SyS_Gadgets(SyS_GadgetNumbers).height       =  DXS GET SPRITE TEXTURE HEIGHT(SyS_Gadgets(SyS_GadgetNumbers).ID)
				SyS_Gadgets(SyS_GadgetNumbers).barwidth     =  DXS GET SPRITE TEXTURE WIDTH(SyS_Gadgets(SyS_GadgetNumbers).ID)
				SyS_Gadgets(SyS_GadgetNumbers).barheight    =  DXS GET SPRITE TEXTURE HEIGHT(SyS_Gadgets(SyS_GadgetNumbers).ID)
				SyS_Gadgets(SyS_GadgetNumbers).maxvalue     =  maxvalue
				SyS_Gadgets(SyS_GadgetNumbers).GadgetType   =  "bar"
			Endif
		Next x
	SyS_RestoreDebugPosition()
Endif
Endfunction






Function SyS_SetGadgetValue(gadgetID$,value)
//***************************************************************************************
//*   Miso                                                                              *
//*     Sets the value of the gadget. It makes sense only with bars and sliders.        *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
If SyS_GuiInitialized=SyS_True
		For y=1 to SyS_GadgetNumbers
			If SyS_Gadgets(y).Gadgetname = gadgetID$ Then SyS_Gadgets(y).value = value
		Next y
Endif
Endfunction






Function SyS_GetGadgetValue(gadgetID$)
//***************************************************************************************
//*   Miso                                                                              *
//*     Returns the value of the gadget. Makes sense with sliders.                      *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
local valuereturner as integer
If SyS_GuiInitialized = SyS_True
		For y=1 to SyS_GadgetNumbers
			If SyS_Gadgets(y).Gadgetname = gadgetID$ Then valuereturner = SyS_Gadgets(y).value
		Next y
Endif
Endfunction valuereturner


Function SyS_GetGadgetX(gadgetID$)
//***************************************************************************************
//*   Miso                                                                              *
//*     Returns the x psoition of upper left points X coord.                            *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
local valuereturner as integer
If SyS_GuiInitialized = SyS_True
		For y=1 to SyS_GadgetNumbers
			If SyS_Gadgets(y).Gadgetname = gadgetID$ Then valuereturner = SyS_Gadgets(y).X
		Next y
Endif
Endfunction valuereturner

Function SyS_GetGadgetY(gadgetID$)
//***************************************************************************************
//*   Miso                                                                              *
//*     Returns the Y position of upper left points coord.                              *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
local valuereturner as integer
If SyS_GuiInitialized = SyS_True
		For y=1 to SyS_GadgetNumbers
			If SyS_Gadgets(y).Gadgetname = gadgetID$ Then valuereturner = SyS_Gadgets(y).X
		Next y
Endif
Endfunction valuereturner




Function SyS_GetGadgetSelection(gadgetID$)
//***************************************************************************************
//*   Miso                                                                              *
//*     Returns 1 if radiobutton is selected/checked.                                   *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
local valuereturner as integer
If SyS_GuiInitialized = SyS_True
		For y=1 to SyS_GadgetNumbers
			If SyS_Gadgets(y).Gadgetname = gadgetID$ Then valuereturner = SyS_Gadgets(y).Selected
		Next y
Endif
Endfunction valuereturner





Function SyS_CountNewValue(gadgetID$)
//***************************************************************************************
//*   Miso                                                                              *
//*     Count a new value of a slider based on the mouse coords and bar positions.      *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
local minimumx as integer
local maximumx as integer
local Barwidth as integer
local mouse_x  as integer
local mouse_y  as integer
local newvalue as integer

If SyS_GuiInitialized = SyS_True
	For y=1 to SyS_GadgetNumbers
		If SyS_Gadgets(y).Gadgetname = gadgetID$ 
			minimumx                    = SyS_Gadgets(y).x
			barwidth                    = SyS_Gadgets(y).barwidth
			mouse_x                     = SyS_Mouse.x
			mouse_y                     = SyS_Mouse.y
			newvalue                    = (mouse_x-minimumx)/barwidth
			if newvalue<0 then newvalue = 0
			if newvalue>SyS_Gadgets(y).maxvalue then newvalue = SyS_Gadgets(y).maxvalue
			SyS_Gadgets(y).value = newvalue-1
		Endif
	Next y
Endif
Endfunction





Function SyS_AddMOuseOverImageToGadget(gadgetID$,gadgetimagename$)
//***************************************************************************************
//*   Miso                                                                              *
//*     Set an image to a gadget mouseover status. If a gadget dont have mouseover      *
//*     image, then mouseover sound wont be played. (Gadget is a panel then)            *
//*                                                                                     *
//***************************************************************************************
Local x as Integer
Local y as Integer

If SyS_GuiInitialized=SyS_True
	SyS_SetDebugPosition("SyS_AddMouseOverImageToGadget()","module_ui.dba")
		SyS_CheckDxSprites()
		For x=1 to SyS_GadgetImageNumbers
			If SyS_Gadgetimages(x).Gadgetimagename=gadgetimagename$
					For y=1 to SyS_GadgetNumbers
						If SyS_Gadgets(y).Gadgetname=gadgetID$ Then SyS_Gadgets(y).mouseoverid=SyS_Gadgetimages(x).Gadgetimagepointer
					Next y
			Endif
		Next x
	SyS_RestoreDebugPosition()
Endif
Endfunction






Function SyS_AddSelectedImageToGadget(gadgetID$,gadgetimagename$)
//***************************************************************************************
//*   Miso                                                                              *
//*     SEts an image to a gadget, shown if the gadget is in selected status.           *
//*     (radiobuttons)                                                                  *
//*                                                                                     *
//***************************************************************************************
Local x as Integer
Local y as integer

If SyS_GuiInitialized=SyS_True
	SyS_SetDebugPosition("SyS_AddSelectionImageToGadget()","module_ui.dba")  :
		SyS_CheckDxSprites()          :
		for x=1 to SyS_GadgetImageNumbers
			If SyS_Gadgetimages(x).Gadgetimagename=gadgetimagename$
					For y=1 to SyS_GadgetNumbers
						If SyS_Gadgets(y).Gadgetname = gadgetID$ Then SyS_Gadgets(y).selectedid = SyS_Gadgetimages(x).Gadgetimagepointer
					Next y
			Endif
			
		Next x
	SyS_RestoreDebugPosition()
Endif
Endfunction




Function SyS_AddTitleToGadget(GadgetID$,FontID,Xx,Yy,stringtext$)
//***************************************************************************************
//*   Miso                                                                              *
//*     Add a title text to gadget.                                                     *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
Local x as Integer
Local y as Integer

If SyS_GuiInitialized=SyS_True
	SyS_SetDebugPosition("SyS_AddTitleToGadget()","module_ui.dba")
		SyS_CheckDxSprites()    
					For y=1 to SyS_GadgetNumbers
						If SyS_Gadgets(y).Gadgetname    =  GadgetID$
							SyS_Gadgets(y).titlefontid  =  fontid
							SyS_Gadgets(y).title        =  stringtext$
							SyS_Gadgets(y).titlex       =  xx
							SyS_Gadgets(y).titley       =  yy
						Endif
					Next y
	SyS_RestoreDebugPosition()
Endif

Endfunction



Function SyS_DeleteGadget(GadgetID$)
//***************************************************************************************
//*   Miso                                                                              *
//*     Deletes a single    gadget. Tested, but still there could be bugs.              *
//*        Please report if finds any.                                                  *
//*                                                                                     *
//***************************************************************************************
Local x as Integer   : `cycle variable
Local y as Integer   : `cycle variable
Local LDA as Integer : `cycle variable
Local LDX as Integer : `cycle variable
Local LDY as Boolean : `True if we made a delete


If SyS_GuiInitialized=SyS_True
	SyS_SetDebugPosition("SyS_DeleteGadget()","module_ui.dba")
		SyS_CheckDxSprites()    
					For y=1 to SyS_GadgetNumbers
						If SyS_Gadgets(y).Gadgetname    =  GadgetID$
							If SyS_GadgetNumbers=1
								Undim SyS_Gadgets()
								Dim SyS_Gadgets(0) as myguitype
								SyS_GadgetNumbers=0
								LDY=SyS_True :` We made a delete
								ExitFunction
							Else
								Dim SyS_temparray(0) as myguitype
								LDX=0
								For LDA=1 to SyS_GadgetNumbers
									If LDA<>y
										LDX=LDX+1
										Array Insert at Bottom SyS_Temparray()
										SyS_temparray(LDX).ID                   = SyS_Gadgets(LDA).ID
										SyS_temparray(LDX).MouseoverID          = SyS_Gadgets(LDA).MouseOverID
										SyS_temparray(LDX).GadgetName           = SyS_Gadgets(LDA).GadgetName
										SyS_temparray(LDX).GadgetType           = SyS_Gadgets(LDA).GadgetType
										SyS_temparray(LDX).X                    = SyS_Gadgets(LDA).X
										SyS_temparray(LDX).Y                    = SyS_Gadgets(LDA).Y
										SyS_temparray(LDX).Width                = SyS_Gadgets(LDA).Width
										SyS_temparray(LDX).Height               = SyS_Gadgets(LDA).Height
										SyS_temparray(LDX).Barwidth             = SyS_Gadgets(LDA).Barwidth
										SyS_temparray(LDX).BarHeight            = SyS_Gadgets(LDA).BarHeight
										SyS_temparray(LDX).TitleFontID          = SyS_Gadgets(LDA).TitleFontID
										SyS_temparray(LDX).TitleX               = SyS_Gadgets(LDA).TitleX
										SyS_temparray(LDX).TitleY               = SyS_Gadgets(LDA).TitleY
										SyS_temparray(LDX).Title                = SyS_Gadgets(LDA).Title
										SyS_temparray(LDX).MouseoverTitleFontID = SyS_Gadgets(LDA).MouseOverTitleFontID
										SyS_temparray(LDX).MouseovertitleX      = SyS_Gadgets(LDA).MouseOverTitleX
										SyS_temparray(LDX).MouseoverTitleY      = SyS_Gadgets(LDA).MouseoverTitleY
										SyS_temparray(LDX).MOuseoverTitle       = SyS_Gadgets(LDA).MouseoverTitle
										SyS_temparray(LDX).Selected             = SyS_Gadgets(LDA).Selected
										SyS_temparray(LDX).SelectedID           = SyS_Gadgets(LDA).SelectedID
										SyS_temparray(LDX).Faded                = SyS_Gadgets(LDA).Faded
										SyS_temparray(LDX).Value                = SyS_Gadgets(LDA).Value
										SyS_temparray(LDX).MaxValue             = SyS_Gadgets(LDA).MaxValue
										SyS_temparray(LDX).MouseInfoExist       = SyS_Gadgets(LDA).MouseInfoExist
										SyS_temparray(LDX).MouseInfoText        = SyS_Gadgets(LDA).MouseInfoText
										SyS_temparray(LDX).MouseInfoOrientation = SyS_Gadgets(LDA).MouseInfoOrientation
									Endif
								Next LDA
								
								Undim SyS_Gadgets()
								Dim SyS_Gadgets(0) as myguitype
								
								For LDA=1 to SyS_GadgetNumbers-1
										Array Insert at Bottom SyS_Gadgets()
										SyS_Gadgets(LDA).ID                   = SyS_Temparray(LDA).ID
										SyS_Gadgets(LDA).MouseoverID          = SyS_Temparray(LDA).MouseOverID
										SyS_Gadgets(LDA).GadgetName           = SyS_Temparray(LDA).GadgetName
										SyS_Gadgets(LDA).GadgetType           = SyS_Temparray(LDA).GadgetType
										SyS_Gadgets(LDA).X                    = SyS_Temparray(LDA).X
										SyS_Gadgets(LDA).Y                    = SyS_Temparray(LDA).Y
										SyS_Gadgets(LDA).Width                = SyS_Temparray(LDA).Width
										SyS_Gadgets(LDA).Height               = SyS_Temparray(LDA).Height
										SyS_Gadgets(LDA).Barwidth             = SyS_Temparray(LDA).Barwidth
										SyS_Gadgets(LDA).BarHeight            = SyS_Temparray(LDA).BarHeight
										SyS_Gadgets(LDA).TitleFontID          = SyS_Temparray(LDA).TitleFontID
										SyS_Gadgets(LDA).TitleX               = SyS_Temparray(LDA).TitleX
										SyS_Gadgets(LDA).TitleY               = SyS_Temparray(LDA).TitleY
										SyS_Gadgets(LDA).Title                = SyS_Temparray(LDA).Title
										SyS_Gadgets(LDA).MouseoverTitleFontID = SyS_Temparray(LDA).MouseOverTitleFontID
										SyS_Gadgets(LDA).MouseovertitleX      = SyS_Temparray(LDA).MouseOverTitleX
										SyS_Gadgets(LDA).MouseoverTitleY      = SyS_Temparray(LDA).MouseoverTitleY
										SyS_Gadgets(LDA).MouseoverTitle       = SyS_Temparray(LDA).MouseoverTitle
										SyS_Gadgets(LDA).Selected             = SyS_Temparray(LDA).Selected
										SyS_Gadgets(LDA).SelectedID           = SyS_Temparray(LDA).SelectedID
										SyS_Gadgets(LDA).Faded                = SyS_Temparray(LDA).Faded
										SyS_Gadgets(LDA).Value                = SyS_Temparray(LDA).Value
										SyS_Gadgets(LDA).MaxValue             = SyS_Temparray(LDA).MaxValue
										SyS_Gadgets(LDA).MouseInfoExist       = SyS_Temparray(LDA).MouseInfoExist
										SyS_Gadgets(LDA).MouseInfoText        = SyS_Temparray(LDA).MouseInfoText
										SyS_Gadgets(LDA).MouseInfoOrientation = SyS_Temparray(LDA).MouseInfoOrientation
								Next LDA
								Undim SyS_Temparray()
								LDY=SyS_True :` We made a delete
							Endif
							IF LDY=SyS_True 
								SyS_GadgetNumbers=SyS_GadgetNumbers-1
								ExitFunction
							Endif
						Endif
					Next y
	
	SyS_RestoreDebugPosition()
Endif
EndFunction


Function SyS_DeleteGuiImage(gadgetimagenameID$)
//***************************************************************************************
//*   Miso                                                                              *
//*     Deletes a single Gui Image.  (Untested)                                         *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
Local x as Integer   : `cycle variable
Local y as Integer   : `cycle variable
Local LDA as Integer : `cycle variable
Local LDX as Integer : `cycle variable
Local LDY as Integer : `True if we find a matching image

If SyS_GuiInitialized=SyS_True
	SyS_SetDebugPosition("SyS_DeleteGuiImage()","module_ui.dba"):SyS_CheckDxSprites()    
				For y=1 to SyS_GadgetImageNumbers
					If SyS_GadgetImages(y).GadgetImageName = gadgetimagenameID$
						If SyS_GadgetimageNumbers = 1
							DXS DELETE SPRITE SyS_GadgetImages(y).GadgetImagePointer
							Undim SyS_GadgetImages()
							Dim SyS_GadgetImages(0) as myguiimagetype
							SyS_GadgetImageNumbers = 0
							ExitFunction
						Else
							Dim SyS_temparray2(0) as MyGuiImagetype
							LDX=0
							For LDA=1 to SyS_GadgetImageNumbers
								LDX=LDX+1
								If LDA<>y
									Array Insert at Bottom SyS_Temparray(0)
									SyS_temparray2(LDX).GadgetImagePointer = SyS_GadgetImages(LDA).GadgetImagePointer
									SyS_temparray2(LDX).GadgetImageName    = SyS_GadgetImages(LDA).GadgetImageName
								Else
									DXS Delete Sprite SyS_GadgetImages(LDA).GadgetImagePointer
								Endif
							Next LDA
								
							Undim SyS_GadgetImages(0)
							Dim SyS_GadgetImages(0) as myguiImagetype
							
							For LDA=1 to SyS_GadgetImageNumbers-1
									Array Insert at Bottom SyS_GadgetImages(0)
									SyS_GadgetImages(LDA).GadgetImagePointer = SyS_temparray2(LDA).GadgetImagePointer
									SyS_GadgetImages(LDA).GadgetImageName    = SyS_temparray2(LDA).GadgetImageName
							Next LDA

							Undim SyS_temparray2(0)
							SyS_Gadgetimagenumbers = SyS_Gadgetimagenumbers-1
							Exitfunction
						Endif
					Endif
				Next y
	 SyS_RestoreDebugPosition()
 Endif
EndFunction




Function SyS_ChangeGadgetTitle(gadgetimagename$,stringtext$)
//***************************************************************************************
//*   Miso                                                                              *
//*     Changes the title text of the gadget.                                           *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
Local x as Integer
Local y as Integer

If SyS_GuiInitialized=SyS_True
	SyS_SetDebugPosition("SyS_ChangeGadgetTitle()","module_ui.dba")
		SyS_CheckDxSprites()    
					For y=1 to SyS_GadgetNumbers
						If SyS_Gadgets(y).Gadgetname    =  gadgetimagename$
							SyS_Gadgets(y).title        =  stringtext$
						Endif
					Next y
	SyS_RestoreDebugPosition()
Endif
Endfunction






Function SyS_ChangeGadgetMouseoverTitle(gadgetimagename$,stringtext$)
//***************************************************************************************
//*   Miso                                                                              *
//*     Change te title text of the gadget for mouseovered event.                       *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
Local x as Integer
Local y as Integer

If SyS_GuiInitialized=SyS_True
	SyS_SetDebugPosition("SyS_ChangeGadgetMouseoverTitle()","module_ui.dba")
		SyS_CheckDxSprites()    
					For y=1 to SyS_GadgetNumbers
						If SyS_Gadgets(y).Gadgetname             =  gadgetimagename$
							SyS_Gadgets(y).Mouseovertitle        =  stringtext$
						Endif
					Next y
	SyS_RestoreDebugPosition()
Endif

Endfunction




Function SyS_SelectGadget(gadgetname$)
//***************************************************************************************
//*   Miso                                                                              *
//*     Adds selected status to gadget.                                                 *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
If SyS_GuiInitialized=SyS_True
	SyS_SetDebugPosition("SyS_SelectGadget()","module_ui.dba")
		SyS_CheckDxSprites()
		
					For y=1 to SyS_GadgetNumbers
							If SyS_Gadgets(y).Gadgetname = gadgetname$
								SyS_Gadgets(y).Selected  = SyS_True
							Endif
					Next y
		
	SyS_RestoreDebugPosition()
Endif
Endfunction





Function SyS_DeSelectGadget(gadgetimagename$)
//***************************************************************************************
//*   Miso                                                                              *
//*     Removes selected status from gadget.                                            *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
If SyS_GuiInitialized=SyS_True
	SyS_SetDebugPosition("SyS_DeselectGadget()","module_ui.dba")
		SyS_CheckDxSprites()
		
					For y=1 to SyS_GadgetNumbers
							If SyS_Gadgets(y).Gadgetname = gadgetimagename$
								SyS_Gadgets(y).Selected = SyS_False
							Endif
					Next y
		
	SyS_RestoreDebugPosition()
Endif
Endfunction





Function SyS_ToggleGadget(param_gadgetname$ as String )
//***************************************************************************************
//*   Miso                                                                              *
//*     Revert selected status of the gadget.                                           *
//*     (radiobuttons)                                                                  *
//*                                                                                     *
//***************************************************************************************
local return_value as Boolean
	If SyS_GuiInitialized=SyS_True
		SyS_SetDebugPosition("SyS_ToggleGadget()","module_ui.dba")
			SyS_CheckDxSprites()
					For y=1 to SyS_GadgetNumbers
						If SyS_Gadgets(y).Gadgetname = param_gadgetname$
							If SyS_Gadgets(y).Selected = 1
								SyS_Gadgets(y).Selected = SyS_False :return_value = SyS_False
							Else
								SyS_Gadgets(y).Selected = SyS_True  :return_value = SyS_True
							Endif
						Endif
					Next y
		SyS_RestoreDebugPosition()
	Endif
Endfunction return_value







Function SyS_AddMouseoverTitleToGadget(gadgetimagename$,FontID,Xx,Yy,stringtext$)
//***************************************************************************************
//*   Miso                                                                              *
//*     Adds a title to the gadget for mouseover event.                                 *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************
If SyS_GuiInitialized=SyS_True
	SyS_SetDebugPosition("SyS_AddMouseOverTitleToGadget()","module_ui.dba")
		SyS_CheckDxSprites()
					For y=1 to SyS_GadgetNumbers
							If SyS_Gadgets(y).Gadgetname=gadgetimagename$
								SyS_Gadgets(y).mouseovertitlefontid  =  fontid
								SyS_Gadgets(y).mouseovertitle        =  stringtext$
								SyS_Gadgets(y).mouseovertitlex       =  xx
								SyS_Gadgets(y).mouseovertitley       =  yy
							Endif
					Next y
	SyS_RestoreDebugPosition()
Endif
Endfunction






Function SyS_AddInfoToGadget(gadgetimagename$,FontID,stringtext$,param_orientation)
//***************************************************************************************
//*   Miso                                                                              *
//*     Add information text to the gadget. Information will be displayed at the mouse. *
//*     param_orientation can be 1,2,3, means oriented left middle and right.           *
//*                                                                                     *
//***************************************************************************************

If SyS_GuiInitialized=SyS_True
	SyS_SetDebugPosition("SyS_AddInfoToGadget()","module_ui.dba")
		SyS_CheckDxSprites()
					For y=1 to SyS_GadgetNumbers
							If SyS_Gadgets(y).Gadgetname=gadgetimagename$
								SyS_Gadgets(y).mouseinfoexist        =  fontid
								SyS_Gadgets(y).mouseinfotext         =  stringtext$
								SyS_Gadgets(y).mouseinfoorientation  =  param_orientation
							Endif
					Next y
	SyS_RestoreDebugPosition()
Endif
Endfunction





Function SyS_HandleGadgets()
//***************************************************************************************
//*   Miso                                                                              *
//*     Auto handles all gadget event. Sets values and draws gadgets.                   *
//*     It's a mess, but works. :)                                                      *
//*                                                                                     *
//*                                                                                     *
//***************************************************************************************

If SyS_GuiInitialized=SyS_True 
	SyS_SetDebugPosition("SyS_HandleGadgets()","module_ui.dba")
		SyS_CheckDxSprites()
		
		If SyS_Gadgetnumbers>0
			SyS_MouseOveredGadget$=" "
				for x=1 to SyS_GadgetNumbers
			
						if SyS_Gadgets(x).mouseoveriD>0 and SyS_Mouse.hidden=0
If SyS_Mouse.X>SyS_Gadgets(x).x and SyS_Mouse.X<SyS_Gadgets(x).x+SyS_Gadgets(x).width and SyS_Mouse.Y>SyS_Gadgets(x).y and SyS_Mouse.Y<SyS_Gadgets(x).y+SyS_Gadgets(x).height
	If SyS_Gadgets(x).gadgettype = "bar"
		Dxs Begin Sprite Render SyS_Gadgets(x).MouseoverID
			For ax=0 to SyS_Gadgets(x).value
				Dxs Draw Sprite SyS_Gadgets(x).MOuseoverID,SyS_Gadgets(x).x+ax*SyS_Gadgets(x).barwidth,SyS_Gadgets(x).y	
			Next ax
		Dxs End Sprite Render SyS_Gadgets(x).MouseoverID
	Else
    	Dxs Begin Sprite Render SyS_Gadgets(x).MouseoverID
			Dxs Draw Sprite SyS_Gadgets(x).MOuseoverID,SyS_Gadgets(x).x,SyS_Gadgets(x).y	
		Dxs End Sprite render SyS_Gadgets(x).MouseoverID
	Endif

	SyS_MouseOveredGadget$ = SyS_Gadgets(x).GadgetName
	If SyS_Mouseclicked = 1 then SyS_OldMouseOveredGadget$ = SyS_MouseOveredGadget$

Else

						  If SyS_Gadgets(x).selected=1
						  	If SyS_Gadgets(x).gadgettype="bar"
						  		Dxs Begin Sprite render SyS_Gadgets(x).SelectedID
						  			For ax=0 to SyS_Gadgets(x).value
						  				Dxs Draw Sprite SyS_Gadgets(x).SelectedID,SyS_Gadgets(x).x+ax*SyS_Gadgets(x).barwidth,SyS_Gadgets(x).y	
						  			Next ax
						  		Dxs End Sprite render SyS_Gadgets(x).SelectedID
						  	Else
						  		Dxs Begin Sprite render SyS_Gadgets(x).SelectedID
						  			Dxs Draw Sprite SyS_Gadgets(x).SelectedID,SyS_Gadgets(x).x,SyS_Gadgets(x).y	
						  		Dxs End Sprite render SyS_Gadgets(x).SelectedID
						  	Endif
						  Else
							If SyS_Gadgets(x).gadgettype="bar"
								Dxs Begin Sprite render SyS_Gadgets(x).ID
									For ax=0 to SyS_Gadgets(x).value
						  				Dxs Draw Sprite SyS_Gadgets(x).ID,SyS_Gadgets(x).x+SyS_Gadgets(x).barwidth*ax,SyS_Gadgets(x).y	
						  			Next ax
						  		Dxs End Sprite render SyS_Gadgets(x).ID
							Else
						  		Dxs Begin Sprite render SyS_Gadgets(x).ID
						  			Dxs Draw Sprite SyS_Gadgets(x).ID,SyS_Gadgets(x).x,SyS_Gadgets(x).y	
						  		Dxs End Sprite render SyS_Gadgets(x).ID
						    Endif
						  Endif
	
Endif
			
						Else
						  If SyS_Gadgets(x).selected=1
						  	If SyS_Gadgets(x).gadgettype="bar"
						  		Dxs Begin Sprite render SyS_Gadgets(x).SelectedID
						  			For ax=0 to SyS_Gadgets(x).value
						  				Dxs Draw Sprite SyS_Gadgets(x).SelectedID,SyS_Gadgets(x).x+SyS_Gadgets(x).barwidth*ax,SyS_Gadgets(x).y	
						  			Next ax
						  		Dxs End Sprite render SyS_Gadgets(x).SelectedID
						   	Else
						   		Dxs Begin Sprite render SyS_Gadgets(x).SelectedID
						  			Dxs Draw Sprite SyS_Gadgets(x).SelectedID,SyS_Gadgets(x).x,SyS_Gadgets(x).y	
						  		Dxs End Sprite render SyS_Gadgets(x).SelectedID
						  	Endif
						  
						  Else
						  
						  	If SyS_Gadgets(x).Gadgettype="bar"
						  		Dxs Begin Sprite render SyS_Gadgets(x).ID
						  			For ax=0 to SyS_Gadgets(x).value
						  				Dxs Draw Sprite SyS_Gadgets(x).ID,SyS_Gadgets(x).x+SyS_Gadgets(x).barwidth*ax,SyS_Gadgets(x).y	
						  			Next ax
						  		Dxs End Sprite render SyS_Gadgets(x).ID
						  	Else
						  		Dxs Begin Sprite render SyS_Gadgets(x).ID
						  			Dxs Draw Sprite SyS_Gadgets(x).ID,SyS_Gadgets(x).x,SyS_Gadgets(x).y	
						  		Dxs End Sprite render SyS_Gadgets(x).ID
						  	Endif
						  Endif
		Endif

If SyS_Gadgets(x).titlefontid>0 
	If SyS_Mouse.X>SyS_Gadgets(x).x and SyS_Mouse.X<SyS_Gadgets(x).x+SyS_Gadgets(x).width and SyS_Mouse.Y>SyS_Gadgets(x).y and SyS_Mouse.Y<SyS_Gadgets(x).y+SyS_Gadgets(x).height and SyS_Mouse.hidden=0
		If SyS_Gadgets(x).mouseovertitlefontid>0 
			SyS_CenterText(SyS_Gadgets(x).MouseovertitlefontID,SyS_Gadgets(x).mouseovertitlex,SyS_Gadgets(x).mouseovertitley,SyS_Gadgets(x).mouseovertitle)
		Else
			SyS_CenterText(SyS_Gadgets(x).titlefontID,SyS_Gadgets(x).titlex,SyS_Gadgets(x).titley,SyS_Gadgets(x).title)
		Endif
	Else
		SyS_CenterText(SyS_Gadgets(x).titlefontID,SyS_Gadgets(x).titlex,SyS_Gadgets(x).titley,SyS_Gadgets(x).title)
	Endif
Endif


// mouseoverinfo check          
If SyS_Gadgets(x).mouseinfoexist>0 
	If SyS_Mouse.X>SyS_Gadgets(x).x and SyS_Mouse.X<SyS_Gadgets(x).x+SyS_Gadgets(x).width and SyS_Mouse.Y>SyS_Gadgets(x).y and SyS_Mouse.Y<SyS_Gadgets(x).y+SyS_Gadgets(x).height and SyS_Mouse.hidden=0
		stringhossz    = len(SyS_Gadgets(x).mouseinfotext)
		ID             = SyS_Gadgets(x).mouseinfoexist
		karaktereltolas= SyS_stringmap(ID,258).ascii
		bitmapeltolas  = karaktereltolas*stringhossz
		
		if SyS_Gadgets(x).mouseinfoorientation=1 then SyS_Text(SyS_Gadgets(x).mouseinfoexist,SyS_Mouse.x+25,SyS_Mouse.Y+25,SyS_Gadgets(x).mouseinfotext)
		if SyS_Gadgets(x).mouseinfoorientation=2 then SyS_CenterText(SyS_Gadgets(x).mouseinfoexist,SyS_Mouse.x,SyS_Mouse.Y+25,SyS_Gadgets(x).mouseinfotext)
		if SyS_Gadgets(x).mouseinfoorientation=3 then SyS_Text(SyS_Gadgets(x).mouseinfoexist,SyS_Mouse.x+25-bitmapeltolas,SyS_Mouse.Y+25,SyS_Gadgets(x).mouseinfotext)
				
	Endif
Endif

Select SyS_Gadgets(x).gadgetname
	Case "SyS_chatbox"
	rem SyS_SUB_Chatboxinput(1,SyS_chatpanel.x-177,SyS_chatpanel.y+a,"> ",29)
	
	Endcase
Endselect

Next x
Endif


if SyS_mouseoveredgadget$<>SyS_OldMouseOveredGadget$ 
	If SyS_mouseoveredgadget$<>" "
		if SyS_MouseoverSND>0 then If sound exist(SyS_MouseOverSND) = SyS_True and SyS_mouseclicked = SyS_False then Play Sound SyS_MouseoverSND
		SyS_OldMouseOveredGadget$        = SyS_MouseOveredGadget$
	Endif
	SyS_OldMouseOveredGadget$ = SyS_MouseOveredGadget$
Endif
	SyS_RestoreDebugPosition()
Endif


// Check the independent texts
If SyS_TextLines>0
	For y=1 to SyS_TextLines
		SyS_CenterText(SyS_Textoutputlines(y).ID,SyS_Textoutputlines(y).X+SyS_TextLinesXOffset,SyS_Textoutputlines(y).Y+SyS_TextLinesYOffset,SyS_Textoutputlines(y).Title)
	Next y
Endif


If SyS_MouseClicked = SyS_True and Mouseclick()=SyS_False then SyS_Mouseclicked=SyS_False

Endfunction




/////////////////////////////////////////////////////
//TIMER   COMMANDS
/////////////////////////////////////////////////////


Function SyS_CreateTextScrollTicker()
//***************************************************************************************
//*   Miso                                                                              *
//*     Internal timer command for textscrolls. Auto creates and destroys when needed.  *
//*                                                                                     *
//***************************************************************************************
	SyS_Textscrolltimer = FIND FREE TICKER()
	MAKE TICKER SyS_TextscrollTimer,60
Endfunction



Function SyS_AskTextScrollTicker()
//***************************************************************************************
//*   Miso                                                                              *
//*     Internal timer command for textscrolls. Automatic.                              *
//*                                                                                     *
//***************************************************************************************
	Local tickresult as Integer
	tickresult = TICKER(SyS_textscrolltimer,1)
Endfunction tickresult




Function SyS_DestroyTextScrollTicker()
//***************************************************************************************
//*   Miso                                                                              *
//*     Internal timer command  for textscrolls. Autocalled.                            *
//*                                                                                     *
//***************************************************************************************
	DELETE TICKER SyS_textscrollTimer
	SyS_textscrolltimer = 0
Endfunction

