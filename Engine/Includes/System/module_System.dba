//////////////////////////////////////////////////////////////
//  Game Engine Standard Modules - CORE SYSTEM MODULE
//  Concept and code by thenerd, Winter 2013!
//////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////
//  DOCUMENTATION
//////////////////////////////////////////////////////////////
//
//////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////
// Constants
//////////////////////////////////////////////////////////////

#constant CONFIGFILE "Config\screen.cfg"

//////////////////////////////////////////////////////////////
// Udts
//////////////////////////////////////////////////////////////

Type t_Screen
	Width As Integer
	Height As Integer
	MiddleWidth As Integer
	MiddleHeight as Integer
	Depth As Integer
	Vsync As Boolean
	Fullscreen As Boolean
	AA As Integer
endtype

//////////////////////////////////////////////////////////////
// Functions
//////////////////////////////////////////////////////////////

Function SYS_Init():
	//////////////////////////////////////
	// Load lua config and set window mode
	//////////////////////////////////////	
	
	If File Exist(CONFIGFILE)=0:
		open to write 1,"config\screen.cfg"
		write string 1,"ScreenWidth=640"
		write string 1,"ScreenHeight=480"
		write string 1,"ScreenDepth=32"
		write string 1,"Vsync=0"
		Write String 1,"Fullscreen=0"
		close file 1
	Endif
	
	Global Screen As t_Screen
	Lua Make : Lua Load File CONFIGFILE
	
   Screen.Width = 		lua Int("ScreenWidth")
   Screen.Height = 		lua Int("ScreenHeight")
	Screen.Depth = 		lua Int("ScreenDepth")
   Screen.Vsync = 		lua Int("Vsync")
	Screen.Fullscreen =  lua Int("Fullscreen")
   Screen.AA = 			lua Int("AA")
	
	Set Display Mode Screen.Width,Screen.Height,Screen.Depth,Screen.Vsync,Screen.AA,0
   if Screen.Fullscreen=1 then set window off
	if Screen.Fullscreen=0 then set window on
	
	//////////////////////////////////////
	// Do standard Dbpro setup
	//////////////////////////////////////
	
	Sync on : sync rate 0 : autocam off
	Disable Escapekey : Hide Mouse
	
	//////////////////////////////////////
	// Do plugin setup
	//////////////////////////////////////
	
	d3d_init
	
Endfunction

Function SYS_Sync():
	
	//////////////////////////////////////
	// Sync function. called once per loop.
	// Modify to add sync-limiter.
	//////////////////////////////////////
	
	Sync
	
Endfunction

Function SYS_Terminate():
Endfunction

Function SYS_Reset():
Endfunction

//////////////////////////////////////////////////////////////
// End of code
//////////////////////////////////////////////////////////////